#include "Map.h"

#include <cstdlib>
#include <ctime>


#include "TextureManager.h"

int Display[20][25] = 
{
	{0,1,2,0,0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,2,0,0,0,1},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2}
};

int Buffer[20][25]=
{
	{0,1,2,0,0,2,0,0,0,0,0,0,0,1,2,0,2,0,0,0,2,0,0,0,1},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
	{0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0},
	{0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,1,0,0,0},
	{0,0,0,0,0,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2}
};


Map::Map()
{
	space1 = TextureManager::LoadTexture("assest/bg1.png");
	space2 = TextureManager::LoadTexture("assest/bg2.png");
	space3 = TextureManager::LoadTexture("assest/bg3.png");

	LoadMap(Display);

	SrcRect.w = DestRect.w = 32;
	SrcRect.h = DestRect.h = 32;
	SrcRect.x = SrcRect.y = 0;
	DestRect.x = DestRect.y = 0;

	TimeCount = 0;
}

Map::~Map()
{
	
}

void Map::LoadMap(int arr[20][25])
{
	for(int row=0;row<20;row++)
	{
		for(int col=0;col<25;col++)
		{
			map[row][col] = arr[row][col];
		}
	}
}

void Map::DrawMap()
{
	int type = 0;

	for (int row = 0; row < 20; row++)
	{
		for (int col = 0; col < 25; col++)
		{
			type = map[row][col];

			DestRect.x = 32 * col;
			DestRect.y = 32 * row;
			
			switch (type)
			{
			case 0:
				TextureManager::Draw(space1, SrcRect, DestRect);
				break;
			case 1:
				TextureManager::Draw(space2, SrcRect, DestRect);
				break;
			case 2:
				TextureManager::Draw(space3, SrcRect, DestRect);
				break;
			default:break;
				
			}
		}
	}
}

void Map::ChangeMap()
{
	int Temp[25];
	for(int i =0;i<24;i++)
	{
		Temp[i] = map[19][i];
	}
	
	for(int i=19;i>0;i--)
	{
		for(int j=0;j<24;j++)
		{
		map[i][j] = map[i - 1][j];
		}
	}
	/*for(int j=0;j<24;j++)
	{
		srand((unsigned)time(NULL));
		map[0][j] = (rand() % 2);
	}*/
	for(int j=0;j<24;j++)
	{
		map[0][j] = Buffer[19][j];
	}
	
	for (int i = 19; i > 0; i--)
	{
		for (int j = 0; j < 24; j++)
		{
			Buffer[i][j] = Buffer[i - 1][j];
		}
	}
	for(int i=0;i<24;i++)
	{
		Buffer[0][i] = Temp[i];
	}
	
	TimeCount = 0;
}


